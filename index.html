<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>體驗頁</title>
  <style>
    :root{
      --bg:#0b1220; --card:#111a2b; --fg:#e8eef9; --muted:#a9b7d1; --accent:#6aa1ff;
      --radius:20px; --shadow:0 10px 30px rgba(0,0,0,.25);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{display:grid;place-items:center;background:radial-gradient(60% 60% at 50% 40%, #0f172a, #0b1220);color:var(--fg);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC","Helvetica Neue",Arial,sans-serif;padding:24px}
    .card{width:min(880px,94vw);background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:28px 28px 22px;border:1px solid rgba(255,255,255,.06)}
    h1{margin:0 0 8px;font-size:clamp(22px,3.5vw,32px);font-weight:700;letter-spacing:.3px}
    p{margin:0;color:var(--muted);line-height:1.6}
    .stack{display:grid;gap:14px;margin-top:10px}
    .btns{display:flex;gap:12px;margin-top:20px}
    button{appearance:none;border:0;border-radius:14px;padding:.9em 1.2em;font-size:16px;font-weight:700;cursor:pointer}
    .btn-primary{background:var(--accent);color:#0b1220}
    .btn-secondary{background:transparent;color:var(--fg);border:1px solid rgba(255,255,255,.18)}
    .hint{margin-top:10px;font-size:12px;color:#9fb3d8}
    .tag{display:inline-block;font-size:12px;padding:.2em .6em;border:1px solid rgba(255,255,255,.15);border-radius:999px;color:#9fb3d8}
    .hidden{display:none}
    .lang{opacity:.92}
    .footer{margin-top:20px;display:flex;gap:8px;flex-wrap:wrap}
    /* 完成頁：五區橫向文字區 */
    .zones{display:grid;grid-template-columns:repeat(5,1fr);gap:16px;margin-top:14px}
    .zone{background:rgba(255,255,255,.03);border:1px dashed rgba(255,255,255,.22);border-radius:12px;padding:16px;min-height:160px}
    .zone h3{margin:0 0 8px;font-size:14px;color:#9fb3d8;font-weight:700}
    @media (max-width: 1024px){.zones{grid-template-columns:repeat(2,1fr)}}
    @media (max-width: 640px){.zones{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <main class="card" id="view-experience" aria-live="polite">
    <h1>體驗結束，請前往下一個體驗。</h1>
    <div class="stack lang">
      <p>This session has ended. Please proceed to the next experience.</p>
      <p>體驗結束，請前往下一個體驗。</p>
      <p>체험이 종료되었습니다. 다음 체험으로 이동해 주세요.</p>
      <p>Trải nghiệm đã kết thúc, vui lòng chuyển sang trải nghiệm tiếp theo.</p>
    </div>
    <div class="btns">
      <button class="btn-primary" id="closeBtn">關閉</button>
    </div>
    <div class="footer"><span class="tag" id="statusTag" aria-live="polite"></span></div>
    <p class="hint">* 本頁面會以您的 IP 為單位計數「關閉」按鈕點擊次數。當同一個 IP 第四次點擊後，將自動前往完成頁。</p>
  </main>

  <section class="card hidden" id="view-done" aria-live="polite">
    <h1>你已完成體驗</h1>
    <p class="hint">請在下方五個區塊貼上你的文字（程式碼內已以註解標示 SECTION 1–5）。</p>

    <div class="zones">
      <div class="zone" id="zone1">
        <h3>區塊 1 / Section 1</h3>
        <!-- SECTION 1: 在此貼上你的文字（可替換以下整段） -->
        <p>（請將你的文字貼在這裡）</p>
      </div>
      <div class="zone" id="zone2">
        <h3>區塊 2 / Section 2</h3>
        <!-- SECTION 2: 在此貼上你的文字（可替換以下整段） -->
        <p>（請將你的文字貼在這裡）</p>
      </div>
      <div class="zone" id="zone3">
        <h3>區塊 3 / Section 3</h3>
        <!-- SECTION 3: 在此貼上你的文字（可替換以下整段） -->
        <p>（請將你的文字貼在這裡）</p>
      </div>
      <div class="zone" id="zone4">
        <h3>區塊 4 / Section 4</h3>
        <!-- SECTION 4: 在此貼上你的文字（可替換以下整段） -->
        <p>（請將你的文字貼在這裡）</p>
      </div>
      <div class="zone" id="zone5">
        <h3>區塊 5 / Section 5</h3>
        <!-- SECTION 5: 在此貼上你的文字（可替換以下整段） -->
        <p>（請將你的文字貼在這裡）</p>
      </div>
    </div>

    <div class="btns">
      <button class="btn-primary" id="thankyouBtn">Thank You</button>
    </div>
    <div class="footer"><span class="tag" id="ipTag" aria-live="polite"></span></div>
    <p class="hint">* 點擊「Thank You」將開啟問卷分頁。</p>
  </section>

  <script>
    const IP_API = 'https://api.ipify.org?format=json';
    const LS_PREFIX = 'ipClicks:';
    const LAST_IP_KEY = 'lastIP';

    const $exp = document.getElementById('view-experience');
    const $done = document.getElementById('view-done');
    const $statusTag = document.getElementById('statusTag');
    const $ipTag = document.getElementById('ipTag');
    const $close = document.getElementById('closeBtn');
    const $thankyou = document.getElementById('thankyouBtn');

    function route(){
      const isDone = location.hash.replace('#','') === 'done';
      $exp.classList.toggle('hidden', isDone);
      $done.classList.toggle('hidden', !isDone);
    }
    window.addEventListener('hashchange', route);
    route();

    async function getIP(){
      try{
        const r = await fetch(IP_API, {cache:'no-store'});
        const j = await r.json();
        if(j && j.ip){
          localStorage.setItem(LAST_IP_KEY, j.ip);
          return j.ip;
        }
      }catch(e){}
      let devKey = localStorage.getItem(LAST_IP_KEY);
      if(!devKey){
        devKey = 'device-' + Math.random().toString(36).slice(2,10);
        localStorage.setItem(LAST_IP_KEY, devKey);
      }
      return devKey;
    }

    function getCountKey(ip){ return LS_PREFIX + ip; }
    function getCount(ip){ const v = localStorage.getItem(getCountKey(ip)); return v ? parseInt(v,10) || 0 : 0; }
    function setCount(ip, n){ localStorage.setItem(getCountKey(ip), String(n)); }

    function showTag(msg){ $statusTag.textContent = msg || ''; }

    $close.addEventListener('click', async () => {
      const ip = await getIP();
      const current = getCount(ip) + 1;
      setCount(ip, current);
      showTag(`此 IP（${ip}）已點擊 ${current} 次`);
      if(current >= 4){
        $ipTag.textContent = `IP：${ip}`;
        location.hash = '#done';
      }
    });

    $thankyou.addEventListener('click', () => {
      window.open('https://docs.google.com/forms/d/e/1FAIpQLSe6uaMAc0PGwD8ei0eOjJXPHfbTOFkueQK5XhAeWXUuklrn6A/viewform', '_blank');
    });

    (async () => {
      const ip = await getIP();
      $ipTag.textContent = ip ? `IP：${ip}` : '';
    })();
  </script>
</body>
</html>
